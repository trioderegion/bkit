{"version":3,"file":"index-Cj2t9j4v.js","sources":["src/systems/dnd5e/dev-sheet.mjs","src/systems/dnd5e/toc-flagger.mjs"],"sourcesContent":["import './dev-sheet.scss';\r\n\r\nexport default class DevSheet5e {\r\n\r\n  static {\r\n    game.settings.register('%id%', 'taboo', {\r\n      name: 'Flatten Item Sheets',\r\n      hint: \"It's...tab-boo :D\",\r\n      scope: 'user',\r\n      type: Boolean,\r\n      config: true,\r\n      default: false,\r\n    });\r\n\r\n    Hooks.on(\"renderActivitySheet\", (app, frame) => {\r\n      frame.classList.toggle('taboo', game.settings.get('%id%', 'taboo'));\r\n    });\r\n\r\n    Hooks.on(\"renderItemSheet5e\", (app, /** @type HTMLElement */ frame) => {\r\n      frame.classList.toggle('taboo', game.settings.get('%id%', 'taboo'));\r\n      if (app.constructor.itemHasActivities(app.document)) {\r\n        app.changeTab('activities', 'primary');\r\n      }\r\n    })\r\n  }\r\n\r\n}\r\n","class FlagData extends foundry.abstract.DataModel {\r\n  static get scope() {\r\n    return 'dnd5e';\r\n  }\r\n\r\n  static get inner() {\r\n    return '';\r\n  }\r\n\r\n  static get flagPath() {\r\n    return `flags.${this.scope}${this.inner}`;\r\n  }\r\n\r\n  read(doc) {\r\n    return foundry.utils.getProperty(doc, this.constructor.flagPath);\r\n  }\r\n\r\n  updateFrom(doc) {\r\n    return this.updateSource(this.read(doc));\r\n  }\r\n}\r\n\r\n\r\nclass ToCEntryData extends FlagData {\r\n  static defineSchema() {\r\n    const fields = foundry.data.fields;\r\n    return {\r\n      title: new fields.StringField({required: false, label: 'Custom Title', nullable: true}),\r\n      type: new fields.StringField({required: false, label: 'Type', choices: {\r\n        chapter: 'Chapter',\r\n        appendix: 'Appendix',\r\n        special: 'Special',\r\n        header: 'Header',\r\n      }}),\r\n      showPages: new fields.BooleanField({required: false, label: 'Show Pages', initial: undefined}),\r\n      position: new fields.NumberField({required: false, label: 'Position', positive: true, integer: true, initial: undefined}),\r\n      append: new fields.NumberField({required: false, label: 'Append Position*', positive: true, integer: true, initial: undefined}),\r\n      order: new fields.NumberField({required: false, label: 'Sort Order*', positive: true, integer: true, initial: undefined}),\r\n    };\r\n  }\r\n\r\n  static cleanData(source = {}, options = {}) {\r\n    const data = super.cleanData(source, options);\r\n    data.title = !!data.title ? data.title : null;\r\n    return data;\r\n  }\r\n}\r\n\r\nclass ToCPageData extends FlagData {\r\n\r\n  static defineSchema() {\r\n    const fields = foundry.data.fields;\r\n    return {\r\n      tocHidden: new fields.BooleanField({required: false, initial: undefined, label: 'Hide Page'}),\r\n    };\r\n  }\r\n}\r\n\r\nclass NavData extends FlagData {\r\n  static defineSchema() {\r\n    const fields = foundry.data.fields;\r\n    return {\r\n      previous: new fields.DocumentIdField({required: false, readonly: false, initial: undefined, label: 'Previous (ID)'}),\r\n      next: new fields.DocumentIdField({required: false, readonly: false, initial: undefined, label: 'Next (ID)'}),\r\n      up: new fields.DocumentIdField({required: false, readonly: false, initial: undefined, label: 'Up (ID)'})\r\n    }\r\n  }\r\n\r\n  static get inner() {\r\n    return '.navigation';\r\n  }\r\n}\r\n\r\nexport default class Flagger extends foundry.applications.api.ApplicationV2 {\r\n  static DEFAULT_OPTIONS = {\r\n    tag: 'form',\r\n    form: {\r\n      submitOnChange: false,\r\n      closeOnSubmit: true,\r\n      handler: this.prototype.submitHandler,\r\n    },\r\n    window: {\r\n      contentClasses: ['standard-form']\r\n    }\r\n  }\r\n\r\n  static APP_CONTROLS = {\r\n    icon: 'fa-table-columns',\r\n    label: 'Configure Flags',\r\n    field: '',\r\n  }\r\n\r\n  static hook() {\r\n    Hooks.on('getHeaderControlsApplicationV2', (app, controls) => {\r\n      controls.push({\r\n        icon: `fa-solid ${this.APP_CONTROLS.icon}`,\r\n        label: this.APP_CONTROLS.label,\r\n        onClick: () => new this({\r\n          document: app.options.document\r\n        }).render({force: true}),\r\n        visible: () => this.compatible(app.options.document),\r\n      });\r\n    });\r\n  }\r\n\r\n  static compatible(doc) {\r\n    return !!doc?.id;\r\n  }\r\n\r\n  flagData = null;\r\n\r\n  get document() {\r\n    return this.options.document;\r\n  }\r\n\r\n  constructor(flagModel, options) {\r\n    super(options);\r\n\r\n    this.flagData = new flagModel();\r\n    this.flagData.updateFrom(this.document);\r\n  }\r\n\r\n  _initializeApplicationOptions(options) {\r\n    options = super._initializeApplicationOptions(options);\r\n    options.window.title = `Flagging ${options.document.documentName}: ${options.document.name}`;\r\n    return options;\r\n  }\r\n\r\n  async _prepareContext(options) {\r\n    const context = await super._prepareContext(options);\r\n    this.flagData.updateFrom(this.document);\r\n    context.entries = Object.entries(this.flagData.schema.fields).map( ([key, field]) => ({\r\n      field,\r\n      value: this.flagData[key],\r\n    }));\r\n\r\n    return context;\r\n  }\r\n\r\n  _ingestSubmit(update) {\r\n    return update;\r\n  }\r\n\r\n  async submitHandler(evt, form, data) {\r\n    const updateData = this._ingestSubmit(data.object);\r\n    this.flagData.updateSource(updateData);\r\n    await this.document.update({[this.flagData.constructor.flagPath]: this.flagData.toObject()});\r\n  }\r\n\r\n  async _renderHTML(context, options) {\r\n    const buttons = await foundry.applications.handlebars.renderTemplate(\"templates/generic/form-footer.hbs\", {buttons: [{type: 'submit', label: 'Submit'}]});\r\n\r\n    /* Render entry inputs */ \r\n    const fieldset = document.createElement('fieldset');\r\n    const legend = document.createElement('legend');\r\n    legend.innerText = this.constructor.APP_CONTROLS.field;\r\n    fieldset.appendChild(legend);\r\n    context.entries.forEach( data => fieldset.appendChild(data.field.toFormGroup({}, {value: data.value})) );\r\n\r\n    return [fieldset, buttons];\r\n  }\r\n\r\n  _replaceHTML(elements, content, options) {\r\n    const footer = elements.pop();\r\n    content.replaceChildren(...elements);\r\n    content.insertAdjacentHTML('beforeend', footer);\r\n  }\r\n}\r\n\r\nclass ToCFlagger extends Flagger {\r\n\r\n  static APP_CONTROLS = {\r\n    icon: 'fa-table-columns',\r\n    label: 'ToC Flags',\r\n    field: 'Table of Contents',\r\n  }\r\n\r\n  static {\r\n    this.hook();\r\n  }\r\n\r\n  static compatible(doc) {\r\n    return super.compatible(doc) && (doc?.documentName.includes('JournalEntry') ?? false);\r\n  }\r\n\r\n  constructor(options) {\r\n    const model = options.document?.documentName === 'JournalEntryPage' ? ToCPageData : ToCEntryData;\r\n    super(model, options);\r\n  }\r\n}\r\n\r\nclass NavFlagger extends Flagger {\r\n  static APP_CONTROLS = {\r\n    icon: 'fa-compass',\r\n    label: 'Nav Flags',\r\n    field: 'Navigation',\r\n  }\r\n\r\n  static compatible(doc) {\r\n    return super.compatible(doc) && (doc.documentName == 'JournalEntry')\r\n  }\r\n\r\n  static {\r\n    this.hook();\r\n  }\r\n\r\n  constructor(options) {\r\n    super(NavData, options);\r\n  }\r\n}\r\n"],"names":["DevSheet5e","game","settings","register","name","hint","scope","type","Boolean","config","default","Hooks","on","app","frame","classList","toggle","get","constructor","itemHasActivities","document","changeTab","FlagData","foundry","abstract","DataModel","inner","flagPath","this","read","doc","utils","getProperty","updateFrom","updateSource","ToCEntryData","defineSchema","fields","data","title","StringField","required","label","nullable","choices","chapter","appendix","special","header","showPages","BooleanField","initial","undefined","position","NumberField","positive","integer","append","order","cleanData","source","options","super","ToCPageData","tocHidden","NavData","previous","DocumentIdField","readonly","next","up","Flagger","applications","api","ApplicationV2","static","tag","form","submitOnChange","closeOnSubmit","handler","prototype","submitHandler","window","contentClasses","icon","field","hook","controls","push","APP_CONTROLS","onClick","render","force","visible","compatible","id","flagData","flagModel","_initializeApplicationOptions","documentName","_prepareContext","context","entries","Object","schema","map","key","value","_ingestSubmit","update","evt","updateData","object","toObject","_renderHTML","buttons","handlebars","renderTemplate","fieldset","createElement","legend","innerText","appendChild","forEach","toFormGroup","_replaceHTML","elements","content","footer","pop","replaceChildren","insertAdjacentHTML","ToCFlagger","includes","NavFlagger"],"mappings":"AAEe,MAAMA,kBAGjBC,KAAKC,SAASC,SAAS,OAAQ,QAAS,CACtCC,KAAM,sBACNC,KAAM,oBACNC,MAAO,OACPC,KAAMC,QACNC,QAAQ,EACRC,SAAS,IAGXC,MAAMC,GAAG,uBAAuB,CAACC,IAAKC,SACpCA,MAAMC,UAAUC,OAAO,QAASf,KAAKC,SAASe,IAAI,OAAQ,SAAS,IAGrEN,MAAMC,GAAG,qBAAqB,CAACC,IAA8BC,SAC3DA,MAAMC,UAAUC,OAAO,QAASf,KAAKC,SAASe,IAAI,OAAQ,UACtDJ,IAAIK,YAAYC,kBAAkBN,IAAIO,WACxCP,IAAIQ,UAAU,aAAc,UAC9B,GAEN,ECxBA,MAAMC,iBAAiBC,QAAQC,SAASC,UACtC,gBAAWnB,GACT,MAAO,OACT,CAEA,gBAAWoB,GACT,MAAO,EACT,CAEA,mBAAWC,GACT,MAAO,SAASC,KAAKtB,QAAQsB,KAAKF,OACpC,CAEA,IAAAG,CAAKC,KACH,OAAOP,QAAQQ,MAAMC,YAAYF,IAAKF,KAAKV,YAAYS,SACzD,CAEA,UAAAM,CAAWH,KACT,OAAOF,KAAKM,aAAaN,KAAKC,KAAKC,KACrC,EAIF,MAAMK,qBAAqBb,SACzB,mBAAOc,GACL,MAAMC,OAASd,QAAQe,KAAKD,OAC5B,MAAO,CACLE,MAAO,IAAIF,OAAOG,YAAY,CAACC,UAAU,EAAOC,MAAO,eAAgBC,UAAU,IACjFpC,KAAM,IAAI8B,OAAOG,YAAY,CAACC,UAAU,EAAOC,MAAO,OAAQE,QAAS,CACrEC,QAAS,UACTC,SAAU,WACVC,QAAS,UACTC,OAAQ,YAEVC,UAAW,IAAIZ,OAAOa,aAAa,CAACT,UAAU,EAAOC,MAAO,aAAcS,aAASC,IACnFC,SAAU,IAAIhB,OAAOiB,YAAY,CAACb,UAAU,EAAOC,MAAO,WAAYa,UAAU,EAAMC,SAAS,EAAML,aAASC,IAC9GK,OAAQ,IAAIpB,OAAOiB,YAAY,CAACb,UAAU,EAAOC,MAAO,mBAAoBa,UAAU,EAAMC,SAAS,EAAML,aAASC,IACpHM,MAAO,IAAIrB,OAAOiB,YAAY,CAACb,UAAU,EAAOC,MAAO,cAAea,UAAU,EAAMC,SAAS,EAAML,aAASC,IAElH,CAEA,gBAAOO,CAAUC,OAAS,GAAIC,QAAU,CAAA,GACtC,MAAMvB,KAAOwB,MAAMH,UAAUC,OAAQC,SAErC,OADAvB,KAAKC,MAAUD,KAAKC,MAAQD,KAAKC,MAAQ,KAClCD,IACT,EAGF,MAAMyB,oBAAoBzC,SAExB,mBAAOc,GAEL,MAAO,CACL4B,UAAW,IAFEzC,QAAQe,KAAKD,OAEJa,aAAa,CAACT,UAAU,EAAOU,aAASC,EAAWV,MAAO,cAEpF,EAGF,MAAMuB,gBAAgB3C,SACpB,mBAAOc,GACL,MAAMC,OAASd,QAAQe,KAAKD,OAC5B,MAAO,CACL6B,SAAU,IAAI7B,OAAO8B,gBAAgB,CAAC1B,UAAU,EAAO2B,UAAU,EAAOjB,aAASC,EAAWV,MAAO,kBACnG2B,KAAM,IAAIhC,OAAO8B,gBAAgB,CAAC1B,UAAU,EAAO2B,UAAU,EAAOjB,aAASC,EAAWV,MAAO,cAC/F4B,GAAI,IAAIjC,OAAO8B,gBAAgB,CAAC1B,UAAU,EAAO2B,UAAU,EAAOjB,aAASC,EAAWV,MAAO,YAEjG,CAEA,gBAAWhB,GACT,MAAO,aACT,EAGa,MAAM6C,gBAAgBhD,QAAQiD,aAAaC,IAAIC,cAC5DC,uBAAyB,CACvBC,IAAK,OACLC,KAAM,CACJC,gBAAgB,EAChBC,eAAe,EACfC,QAASpD,KAAKqD,UAAUC,eAE1BC,OAAQ,CACNC,eAAgB,CAAC,mBAIrBT,oBAAsB,CACpBU,KAAM,mBACN3C,MAAO,kBACP4C,MAAO,IAGT,WAAOC,GACL5E,MAAMC,GAAG,kCAAkC,CAACC,IAAK2E,YAC/CA,SAASC,KAAK,CACZJ,KAAM,YAAYzD,KAAK8D,aAAaL,OACpC3C,MAAOd,KAAK8D,aAAahD,MACzBiD,QAAS,IAAM,IAAI/D,KAAK,CACtBR,SAAUP,IAAIgD,QAAQzC,WACrBwE,OAAO,CAACC,OAAO,IAClBC,QAAS,IAAMlE,KAAKmE,WAAWlF,IAAIgD,QAAQzC,WAC3C,GAEN,CAEA,iBAAO2E,CAAWjE,KAChB,QAASA,KAAKkE,EAChB,CAEAC,SAAW,KAEX,YAAI7E,GACF,OAAOQ,KAAKiC,QAAQzC,QACtB,CAEA,WAAAF,CAAYgF,UAAWrC,SACrBC,MAAMD,SAENjC,KAAKqE,SAAW,IAAIC,UACpBtE,KAAKqE,SAAShE,WAAWL,KAAKR,SAChC,CAEA,6BAAA+E,CAA8BtC,SAG5B,OAFAA,QAAUC,MAAMqC,8BAA8BtC,UACtCsB,OAAO5C,MAAQ,YAAYsB,QAAQzC,SAASgF,iBAAiBvC,QAAQzC,SAAShB,OAC/EyD,OACT,CAEA,qBAAMwC,CAAgBxC,SACpB,MAAMyC,cAAgBxC,MAAMuC,gBAAgBxC,SAO5C,OANAjC,KAAKqE,SAAShE,WAAWL,KAAKR,UAC9BkF,QAAQC,QAAUC,OAAOD,QAAQ3E,KAAKqE,SAASQ,OAAOpE,QAAQqE,KAAK,EAAEC,IAAKrB,UAAM,CAC9EA,MACAsB,MAAOhF,KAAKqE,SAASU,SAGhBL,OACT,CAEA,aAAAO,CAAcC,QACZ,OAAOA,MACT,CAEA,mBAAM5B,CAAc6B,IAAKlC,KAAMvC,MAC7B,MAAM0E,WAAapF,KAAKiF,cAAcvE,KAAK2E,QAC3CrF,KAAKqE,SAAS/D,aAAa8E,kBACrBpF,KAAKR,SAAS0F,OAAO,CAAC,CAAClF,KAAKqE,SAAS/E,YAAYS,UAAWC,KAAKqE,SAASiB,YAClF,CAEA,iBAAMC,CAAYb,QAASzC,SACzB,MAAMuD,cAAgB7F,QAAQiD,aAAa6C,WAAWC,eAAe,oCAAqC,CAACF,QAAS,CAAC,CAAC7G,KAAM,SAAUmC,MAAO,aAGvI6E,SAAWnG,SAASoG,cAAc,YAClCC,OAASrG,SAASoG,cAAc,UAKtC,OAJAC,OAAOC,UAAY9F,KAAKV,YAAYwE,aAAaJ,MACjDiC,SAASI,YAAYF,QACrBnB,QAAQC,QAAQqB,SAAStF,MAAQiF,SAASI,YAAYrF,KAAKgD,MAAMuC,YAAY,CAAA,EAAI,CAACjB,MAAOtE,KAAKsE,WAEvF,CAACW,SAAUH,QACpB,CAEA,YAAAU,CAAaC,SAAUC,QAASnE,SAC9B,MAAMoE,OAASF,SAASG,MACxBF,QAAQG,mBAAmBJ,UAC3BC,QAAQI,mBAAmB,YAAaH,OAC1C,EAGF,MAAMI,mBAAmB9D,QAEvBI,oBAAsB,CACpBU,KAAM,mBACN3C,MAAO,YACP4C,MAAO,4BAIP1D,KAAK2D,MACT,CAEE,iBAAOQ,CAAWjE,KAChB,OAAOgC,MAAMiC,WAAWjE,OAASA,KAAKsE,aAAakC,SAAS,kBAAmB,EACjF,CAEA,WAAApH,CAAY2C,SAEVC,MADiD,qBAAnCD,QAAQzC,UAAUgF,aAAsCrC,YAAc5B,aACvE0B,QACf,EAGF,MAAM0E,mBAAmBhE,QACvBI,oBAAsB,CACpBU,KAAM,aACN3C,MAAO,YACP4C,MAAO,cAGT,iBAAOS,CAAWjE,KAChB,OAAOgC,MAAMiC,WAAWjE,MAA6B,gBAApBA,IAAIsE,YACvC,QAGExE,KAAK2D,MACT,CAEE,WAAArE,CAAY2C,SACVC,MAAMG,QAASJ,QACjB"}