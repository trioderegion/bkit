{"version":3,"file":"index.mjs","sources":["src/common/module/custom-doc-index.mjs","src/common/module/Extractor/TypeExtract/base.mjs","src/common/module/Extractor/TypeExtract/pages.mjs","src/common/module/Extractor/TypeExtract/items.mjs","src/common/module/Extractor/TypeExtract/tables.mjs","src/common/module/Extractor/extractor.mjs","src/common/app/DataView/dataview.mjs","src/index.mjs"],"sourcesContent":["export default class CustomDocIndex {\r\n\r\n  static augmentIndex() {\r\n    const {_indexCompendium, _indexWorldCollection, _indexEmbeddedDocuments} = game.documentIndex;\r\n    function indexCompendium(pack) {\r\n      const packages = game.settings.get('%id%', 'docIndexPackages');\r\n      if (packages.has(pack.metadata.packageName))\r\n        _indexCompendium.call(game.documentIndex, pack);\r\n    }\r\n\r\n    function indexEmbeddedDocuments(parent) {\r\n      const packages = game.settings.get('%id%', 'docIndexPackages');\r\n      if (packages.has('embedded'))\r\n        _indexEmbeddedDocuments.call(game.documentIndex, parent);\r\n    }\r\n\r\n    function indexWorldCollection(documentName) {\r\n      const packages = game.settings.get('%id%', 'docIndexPackages');\r\n      if (packages.has('world'))\r\n        _indexWorldCollection.call(game.documentIndex, documentName);\r\n    }\r\n\r\n    game.documentIndex._indexCompendium = indexCompendium;\r\n    game.documentIndex._indexEmbeddedDocuments = indexEmbeddedDocuments;\r\n    game.documentIndex._indexWorldCollection = indexWorldCollection;\r\n\r\n  }\r\n\r\n  static {\r\n\r\n    Hooks.on('setup', () => {\r\n      const packages = game.getPackageScopes().filter(e => e !== 'core');\r\n      packages.push('embedded');\r\n      const choices = Object.fromEntries(packages.map( scope => [scope, scope]));\r\n\r\n      game.settings.register('%id%', 'docIndexPackages', {\r\n        name: 'Document Index Sources',\r\n        hint: 'Defines packages to be added to the Document Index',\r\n        scope: 'user',\r\n        config: true,\r\n        type: new foundry.data.fields.SetField(\r\n          new foundry.data.fields.StringField({choices})\r\n        ),\r\n        default: packages,\r\n        onChange: _ => {\r\n          Object.keys(game.documentIndex.trees).forEach( tree => delete game.documentIndex.trees[tree] );\r\n          Object.keys(game.documentIndex.uuids).forEach( uuid => delete game.documentIndex.uuids[uuid] );\r\n          game.documentIndex.index().then( _ => {\r\n            ui.notifications.info('Document Index replaced.');\r\n          });\r\n        }\r\n      });\r\n      \r\n      this.augmentIndex();\r\n    });\r\n  }\r\n}\r\n\r\n","export default class ExtractorBase {\r\n  genID(name, prefix = '') {\r\n    const id = `${prefix}${name.slugify({lowercase: false, replacement: '', strict: true})}`;\r\n    if (id.length >= 16) return id.substring(0, 16);\r\n    return id.padEnd(16, 'F');\r\n  }\r\n\r\n  async validateTarget({id, type, target}) {\r\n\r\n    /* Creation Context */\r\n    const context = {pack: null, parent: null};\r\n    const targetParts = target.split('|');\r\n    switch (targetParts.at(0)) {\r\n      case 'PACK':\r\n        context.pack = targetParts.at(1);\r\n        break;\r\n      case 'SHEET':\r\n        context.parent = await fromUuid(targetParts.at(1));\r\n        break;\r\n    }\r\n\r\n    const uuid = foundry.utils.buildUuid({id, documentName: type, ...context});\r\n    if (await fromUuid(uuid)) {\r\n      ui.notifications.error(`Putative UUID already exists! [${uuid}]`);\r\n      throw new Error(`Putative UUID already exists! [${uuid}]`);\r\n    }\r\n\r\n    return context;\r\n  }\r\n\r\n  parseRange(range = '') {\r\n    let [lower, upper] = range.split('–').flatMap(p => p.split('-'));\r\n    if (lower == '00') lower = '100';\r\n    if (upper == '00') upper = '100';\r\n    upper ??= lower;\r\n    console.log(upper, lower);\r\n    lower = Number(lower);\r\n    upper = Number(upper);\r\n\r\n    if (isNaN(lower) || isNaN(upper)) {\r\n      return [NaN, NaN]\r\n    }\r\n\r\n    return [lower, upper];\r\n  }\r\n\r\n  async promptContext(type = 'Item', options = {}) {\r\n    options = foundry.utils.mergeObject(game.user.getFlag('%id%', `${type}-extractor`) ?? {}, options);\r\n\r\n    const targets = {\r\n      'WORLD': 'World',\r\n    }\r\n\r\n    const ourPacks = this.unlockedPacks();\r\n    const openSheets = this.openSheets();\r\n\r\n    ourPacks.forEach(info => targets['PACK|' + info.id] = `${info.label} (${info.packageName})`);\r\n    openSheets.forEach(doc => targets['SHEET|' + doc.uuid] = doc.name);\r\n\r\n    const fields = [\r\n      new foundry.data.fields.StringField({label: 'Document Prefix'}).toFormGroup({}, {name: 'prefix', value: options.prefix}).outerHTML,\r\n      new foundry.data.fields.StringField({label: 'Target Collection'}).toFormGroup({}, {name: 'target', value: options.target ?? 'WORLD', choices: targets}).outerHTML,\r\n    ]\r\n\r\n    const content = `<fieldset>${fields.join('')}</fieldset>`;\r\n\r\n    const answer = await foundry.applications.api.DialogV2.prompt({\r\n      content,\r\n      title: 'Document Extraction Context',\r\n      ok: {\r\n        callback: (event, button) => new foundry.applications.ux.FormDataExtended(button.form).object\r\n      },\r\n      rejectClose: true\r\n    });\r\n\r\n    const result = foundry.utils.mergeObject(options, answer);\r\n    await game.user.setFlag('%id%', `${type}-extractor`, result);\r\n\r\n    return result;\r\n  }\r\n\r\n\r\n  unlockedPacks(type = 'Item') {\r\n    const packs = game.packs.filter(p => !p.config.locked && p.metadata.type === type).map(p => p.metadata);\r\n    return packs;\r\n  }\r\n\r\n  openSheets(type = 'Item') {\r\n    const collectionField = CONFIG[type].documentClass.metadata.collection;\r\n    if (!collectionField) return [];\r\n    return Array.from(foundry.applications.instances.values())\r\n      .filter(app => app.document?.collections[collectionField])\r\n      .map(app => app.document);\r\n  }\r\n\r\n  getSelection() {\r\n    const selection = window.getSelection();\r\n\r\n    if (selection.type !== \"Range\") {\r\n      ui.notifications.error(\"No Range selected for document extraction!\");\r\n      return;\r\n    }\r\n\r\n    /* get 'top' and 'bottom' ordered */\r\n    if (selection.anchorOffset > selection.extentOffset) {\r\n      ui.notifications.warn(\"Please select top to bottom.\");\r\n      return;\r\n    }\r\n\r\n    selection.modify(\"extend\", \"right\", \"lineboundary\");\r\n\r\n    const initialRange = selection.getRangeAt(0);\r\n    const start =\r\n      initialRange.commonAncestorContainer.nodeName == \"P\"\r\n        ? initialRange.commonAncestorContainer\r\n        : selection.anchorNode.parentElement;\r\n\r\n    selection.setBaseAndExtent(\r\n      start,\r\n      0,\r\n      selection.extentNode,\r\n      selection.extentOffset\r\n    );\r\n\r\n    const fullRange = selection.getRangeAt(0);\r\n\r\n    return {range: fullRange};\r\n  }\r\n}\r\n\r\n","import ExtractorBase from './base.mjs';\r\n\r\nexport default class PageSplitter extends ExtractorBase {\r\n\r\n  static {\r\n    Hooks.on('%id%.extractorEntries', entries => {\r\n      entries.push({\r\n        title: 'Split Headers',\r\n        action: 'split-headers',\r\n        cmd: (state, dispatch, view) => {\r\n          const element = view.dom.closest('prose-mirror');\r\n          const pageuuid = element?.dataset?.documentUuid;\r\n          new this().split({pageuuid});\r\n        }\r\n      });\r\n    });\r\n  }\r\n\r\n  async split({pageuuid = null, targetuuid = null, level = null, type = 'text'}) {\r\n    const fields = [\r\n      new foundry.data.fields.StringField({label: 'Page to Split'}).toFormGroup({}, {name: 'pageuuid', value: pageuuid}).outerHTML,\r\n      new foundry.data.fields.DocumentUUIDField({label: 'Target Journal'}).toFormGroup({}, {name: 'targetuuid', value: targetuuid}).outerHTML,\r\n      new foundry.data.fields.NumberField({label: 'Split at Header'}).toFormGroup({}, {name: 'level', value: level, choices: {1: 1, 2: 2, 3: 3, 4: 4, 5: 5}}).outerHTML,\r\n      new foundry.data.fields.StringField({label: 'Create as Type'}).toFormGroup({}, {name: 'type', value: type ?? 'text'}).outerHTML,\r\n\r\n    ]\r\n\r\n    const content = `<fieldset>${fields.join('')}</fieldset>`;\r\n\r\n    const answer = await foundry.applications.api.DialogV2.prompt({\r\n      content,\r\n      title: 'Split Page by Headers',\r\n      ok: {\r\n        callback: (event, button) => new FormDataExtended(button.form).object\r\n      },\r\n      position: {top: 100},\r\n      rejectClose: true\r\n    })\r\n\r\n    pageuuid = answer.pageuuid;\r\n    targetuuid = answer.targetuuid;\r\n    level = answer.level;\r\n    type = answer.type;\r\n\r\n    const targetHeaders = Array.from({length: level}, (v, i) => `h${i + 1}`);\r\n    const elementToSplitOn = `:is(${targetHeaders.join(',')})`\r\n\r\n    const page = await fromUuid(pageuuid);\r\n    const journal = await fromUuid(targetuuid);\r\n\r\n    function nextUntil(elem, selector, filter) {\r\n\r\n      // matches() polyfill\r\n      if (!Element.prototype.matches) {\r\n        Element.prototype.matches = Element.prototype.msMatchesSelector || Element.prototype.webkitMatchesSelector;\r\n      }\r\n\r\n      // Setup siblings array\r\n      const siblings = [];\r\n\r\n      // Get the next sibling element\r\n      elem = elem.nextElementSibling;\r\n\r\n      // As long as a sibling exists\r\n      while (elem) {\r\n\r\n        // If we've reached our match, bail\r\n        if (elem.matches(selector)) break;\r\n\r\n        // If filtering by a selector, check if the sibling matches\r\n        if (filter && !elem.matches(filter)) {\r\n          elem = elem.nextElementSibling;\r\n          continue;\r\n        }\r\n\r\n        // Otherwise, push it to the siblings array\r\n        siblings.push(elem);\r\n\r\n        // Get the next sibling element\r\n        elem = elem.nextElementSibling;\r\n\r\n      }\r\n\r\n      return siblings;\r\n\r\n    };\r\n\r\n    const div = document.createElement(\"div\");\r\n    div.innerHTML = page.text.content;\r\n    const headings = div.querySelectorAll(elementToSplitOn);\r\n    const pageData = [];\r\n\r\n    for (const heading of headings) {\r\n      let siblings = nextUntil(heading, elementToSplitOn);\r\n      let pageHTML = \"\";\r\n      for (const sibling of siblings) {\r\n        pageHTML += sibling.outerHTML;\r\n      }\r\n      pageData.push({type, name: heading.innerText ?? '(No Title)', \"text.content\": pageHTML, \"title.level\": heading.tagName.at(1)});\r\n\r\n    }\r\n\r\n    await journal.createEmbeddedDocuments(\"JournalEntryPage\", pageData);\r\n  }\r\n}\r\n\r\n","import ExtractorBase from './base.mjs';\r\n\r\nclass KeepIdItem extends CONFIG.Item.documentClass {\r\n  static async create(data = {}, operation = {}) {\r\n    operation.keepId = true;\r\n    return super.create(data, operation);\r\n  }\r\n\r\n  static get implementation() {return this};\r\n}\r\n\r\n/** @TODO some parsing is system specific, but should \"fail\" gracefully */\r\nexport default class ItemExtractor extends ExtractorBase {\r\n\r\n  static {\r\n    Hooks.on('%id%.extractorEntries', entries => {\r\n      entries.push({\r\n        title: 'Extract Item',\r\n        action: 'extract-item',\r\n        cmd: () => new this().extract()\r\n      });\r\n    })\r\n  }\r\n\r\n  nameFromChildren(childNodes) {\r\n    while (childNodes.length > 0) {\r\n      const node = childNodes[0];\r\n      let nodeText = \"\";\r\n\r\n      if (node.hasChildNodes()) {\r\n        nodeText = this.nameFromChildren(node.childNodes);\r\n        if (!node.hasChildNodes()) node.remove();\r\n      } else {\r\n        /* trim name of whitespace and remove any trailing punctuation */\r\n        nodeText = node.textContent.trim().replace(/[^\\w\\d\\)]\\.*$/, \"\");\r\n        node.remove();\r\n      }\r\n\r\n      if (nodeText.length > 0) {\r\n        return nodeText;\r\n      }\r\n    }\r\n  }\r\n\r\n  async extract() {\r\n    const {range: fullRange = null} = this.getSelection();\r\n    const fragment = fullRange.cloneContents();\r\n\r\n    const wrapper = document.createElement(\"div\");\r\n    wrapper.appendChild(fragment);\r\n\r\n    /* try to figure out where the name of the document lives */\r\n    let name = this.nameFromChildren(wrapper.childNodes);\r\n    const caption = name;\r\n    name = name.replace('’', \"'\");\r\n    const priceRegex = /\\s*\\((?<value>\\d*,?\\d+) (?<denomination>[PGESC]P)\\)/\r\n    const result = priceRegex.exec(name);\r\n\r\n    let price = {\r\n      value: '0',\r\n      denomination: 'gp',\r\n    };\r\n\r\n    if (result) {\r\n      name = name.substring(0, result.index).trim();\r\n      price.value = result.groups.value.replace(',', '');\r\n      price.denomination = result.groups.denomination.toLowerCase();\r\n    }\r\n\r\n    if (name.length < 1) {\r\n      ui.notifications.error(\r\n        \"Could not identify valid document name from selection\"\r\n      );\r\n      return;\r\n    }\r\n\r\n    const answer = await this.promptContext('Item');\r\n    if (!answer) return;\r\n\r\n    /* if a non <p> is the remaining first child, its likely an inline item */\r\n    if (!['H1', 'H2', 'H3', 'P'].includes(wrapper.firstChild.nodeName)) {\r\n      const parawrapper = document.createElement(\"p\");\r\n      parawrapper.replaceChildren(...wrapper.childNodes);\r\n      wrapper.replaceChildren(parawrapper);\r\n    }\r\n\r\n    let description = wrapper.innerHTML.trim();\r\n    /* move parenthetical uses into item description */\r\n    const paraRegex = /\\((?<use>[\\w\\d\\s]+)\\)\\./;\r\n    const paraResult = paraRegex.exec(name);\r\n    if (paraResult) {\r\n      name = name.substring(0, result.index).trim();\r\n      description = `<p><strong>${result.groups.use}</strong></p>` + description;\r\n    }\r\n\r\n    /* Class features often lead with \"Level N:\" */\r\n    let itemLevel;\r\n    const levelRegex = /level\\s(?<level>\\d\\d?)\\:?/i\r\n    const levelResult = levelRegex.exec(name);\r\n    if (levelResult) {\r\n      name = levelResult.input.replace(levelResult[0], \"\").trim();\r\n      itemLevel = Number(levelResult.groups.level);\r\n    }\r\n\r\n    /* Creation Data */\r\n    const data = foundry.utils.expandObject({\r\n      _id: this.genID(name, answer.prefix),\r\n      type: answer.type ?? 'feat',\r\n      folder: answer.folder,\r\n      name,\r\n      \"system.description.value\": description,\r\n      \"system.price\": price,\r\n      \"system.prerequisites.level\": itemLevel,\r\n    });\r\n\r\n    /* Creation Context */\r\n    const context = this.validateTarget({id: data._id, type: 'Item', target: answer.target});\r\n\r\n    const item = await KeepIdItem.createDialog(data, context);\r\n    const embedText = `@Embed[${item.uuid} classes=\"caption-top item-card\"]{${caption}}`;\r\n    navigator.clipboard.writeText(embedText);\r\n    ui.notifications.info(`\"${embedText}\" written to clipboard.`);\r\n    await game.user.setFlag('%id%', 'Item-extractor', {type: item.type, folder: item.folder?.id});\r\n  }\r\n}\r\n\r\n","import ExtractorBase from './base.mjs';\r\n\r\nexport default class TableExtractor extends ExtractorBase {\r\n\r\n  static {\r\n    Hooks.on('%id%.extractorEntries', entries => {\r\n      entries.push({\r\n        title: 'Extract Table',\r\n        action: 'extract-table',\r\n        cmd: (state, dispatch, view) => this.extract(state, view)\r\n      });\r\n    })\r\n  }\r\n\r\n  static async extract(state, view) {\r\n    /* Get table around cursor position */\r\n    const cursor = view.domAtPos(state.selection.anchor).node;\r\n    const element = cursor?.nodeType === cursor.TEXT_NODE ? cursor.parentElement : cursor;\r\n    const table = element.closest('table');\r\n    const extractor = new this(table);\r\n    extractor.parse();\r\n  }\r\n\r\n  /** @type HTMLElement */\r\n  table = null;\r\n\r\n\r\n  extract = {\r\n    name: '(No Title)',\r\n  };\r\n\r\n  embed = {\r\n    resultLabel: null,\r\n  }\r\n\r\n\r\n  constructor(tableElement) {\r\n    super();\r\n    this.table = tableElement;\r\n    this.lines = this._extract();\r\n  }\r\n\r\n  async parse() {\r\n    const answers = await this.promptContext('RollTable');\r\n    const lines = foundry.utils.duplicate(this.lines);\r\n    const name = lines.shift().trim().replace('’', \"'\").replace().replace('“', '\"').replace('”', '\"');\r\n    const id = this.genID(name, answers.prefix);\r\n    await this.validateTarget({id, type: 'RollTable', target: answers.target});\r\n\r\n    const formula = lines.shift();\r\n    const resultLabel = lines.shift().replace(/\\<[^\\>]*\\>/g, '').trim();\r\n\r\n    const rawPairs = [];\r\n    while (lines.length) {\r\n      const range = lines.shift();\r\n      const resultLines = []\r\n      do {\r\n        resultLines.push(lines.shift());\r\n      } while (this.parseRange(lines.at(0)).some(isNaN))\r\n\r\n      const text = resultLines.join();\r\n\r\n      rawPairs.push([range, text]);\r\n    }\r\n\r\n    const results = rawPairs.map(([range, value]) => this._createEntry(range, value));\r\n\r\n    const data = {_id: id, name, results, formula};\r\n\r\n    await RollTable.create(data, {pack: answers.targetPack, keepId: true}).then(table => {\r\n      table.sheet.render(true);\r\n      navigator.clipboard.writeText(`@Embed[${table.uuid} rollable classes=\"caption-top\" resultLabel=\"${resultLabel}\"]{${name}}`);\r\n    });\r\n  }\r\n\r\n  _createEntry(range, value) {\r\n    const parsedRange = this.parseRange(range);\r\n    return {\r\n      type: 0,\r\n      text: value,\r\n      range: parsedRange,\r\n    };\r\n  }\r\n\r\n  _discoverTitle() {\r\n    let node = this.table;\r\n    while (!node.previousElementSibling) {\r\n      node = node.parentElement;\r\n    }\r\n\r\n    if (node.classList.contains('ProseMirror')) return this.extract.name;\r\n\r\n    return node?.previousElementSibling?.textContent.trim() ?? this.extract.name;\r\n  }\r\n\r\n  _extract() {\r\n    const entries = []\r\n\r\n    /* If the table has a caption element, it will be grabbed.\r\n     * Otherwise, look at the prior sibling of this table */\r\n    if (!this.table.querySelector('caption')) {\r\n      entries.push([this._discoverTitle()]);\r\n    } else {\r\n      entries.push([this.table.querySelector('caption').innerText.trim()])\r\n    }\r\n\r\n    const rows = this.table.getElementsByTagName('tr');\r\n    for (const row of rows) {\r\n      const headers = row.getElementsByTagName('th')\r\n      if (headers.length) {\r\n        const [first, ...rest] = headers;\r\n        const result = rest.map( e => e.innerText ).join(''); \r\n        entries.push([first.innerText.trim(), result.trim()]);\r\n      }\r\n\r\n      const cells = row.getElementsByTagName('td');\r\n      if (cells.length) {\r\n        const [first, ...rest] = cells;\r\n        const result = rest.map( e => e.innerHTML ).join(''); \r\n        entries.push([first.innerText.trim(), result.trim()]);\r\n      } \r\n    }\r\n    console.debug(entries); \r\n    return entries.flat();\r\n  }\r\n\r\n}\r\n","import './TypeExtract';\r\n\r\nexport default class ProseMirrorExtractor {\r\n  static {\r\n    Hooks.on('getProseMirrorMenuDropDowns', (proseMirrorMenu, dropdowns) => {\r\n      const entries = [];\r\n      Hooks.callAll('%id%.extractorEntries', entries);\r\n      dropdowns['%id%'] = {\r\n        action: 'badger',\r\n        title: '<i class=\"fa-solid fa-helmet-safety\"></i>',\r\n        entries,\r\n      }\r\n    });\r\n  }\r\n}\r\n\r\n","export default class DataView extends foundry.applications.api.ApplicationV2 {\r\n\r\n  static DEFAULT_OPTIONS = {\r\n    window: {\r\n      resizable: true,\r\n    },\r\n    actions: {\r\n      jsonclick: (evt, target) => {\r\n        if (target.lastFocusedItem && 'path' in target.lastFocusedItem.dataset) {\r\n          const root = target.dataset.path;\r\n          const inner = target.lastFocusedItem.dataset.path;\r\n          const path = root + inner;\r\n          navigator.clipboard.writeText(path);\r\n          console.log(`\"${path}\" copied to clipboard with value:`, foundry.utils.getProperty(target.data, inner));\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  static {\r\n    Hooks.on('getHeaderControlsApplicationV2', (app, controls) => {\r\n      controls.push({\r\n        icon: 'fa-solid fa-magnifying-glass',\r\n        label: 'Inspect Data',\r\n        onClick: () => new this({\r\n          document: app.options.document\r\n        }).render({force: true}),\r\n        visible: () => app.options.document,\r\n      });\r\n    });\r\n  }\r\n\r\n  static TABS = {\r\n    \"app\": {\r\n      initial: 'core',\r\n      tabs: [{\r\n        id: 'core', icon: 'fa-solid fa-file-code', label: 'Core', path: '',\r\n      },{\r\n        id: 'system', icon: 'fa-solid fa-book', label: 'System', path: 'system.',\r\n      },{\r\n        id: 'flags', icon: 'fa-solid fa-flag', label: 'Flags', path: 'flags.'\r\n      },{\r\n        id: 'roll', icon: 'fa-solid fa-dice', label: 'Roll Data', functionName: 'getRollData', path: '@',\r\n      }]\r\n    }\r\n  }\r\n\r\n  _initializeApplicationOptions(options) {\r\n    options = super._initializeApplicationOptions(options);\r\n    options.window.title = `Inspecting ${options.document.documentName}: ${options.document.name}`;\r\n    return options;\r\n  }\r\n\r\n  async _onFirstRender(context, options) {\r\n    if ('apps' in (options.document ?? {})) options.document.apps[this.id] = this;\r\n    return super._onFirstRender(context, options);\r\n  }\r\n\r\n  _onClose(options) {\r\n    if ('apps' in (this.options.document ?? {})) delete this.options.document.apps[this.id];\r\n    return super._onClose(options);\r\n  }\r\n\r\n  async _prepareContext(options) {\r\n    const context = await super._prepareContext(options);\r\n    const {system, flags, ...core} = this.options.document.toObject();\r\n    const roll = await this.options.document.getRollData?.();\r\n\r\n    context.core = foundry.utils.isEmpty(core) ? null : JSON.stringify(core);\r\n    context.system = foundry.utils.isEmpty(system) ? null : JSON.stringify(system);\r\n    context.flags = foundry.utils.isEmpty(flags) ? null : JSON.stringify(flags);\r\n    context.roll = foundry.utils.isEmpty(roll) ? null : JSON.stringify(roll);\r\n    \r\n    return context;\r\n  }\r\n\r\n  async _renderHTML(context, options) {\r\n    const navHTML = await renderTemplate(\"templates/generic/tab-navigation.hbs\", context);\r\n\r\n    const views = Object.values(context.tabs).map( ({id, cssClass = '', functionName = null, path = ''}) => {\r\n      const container = document.createElement('div');\r\n      container.dataset.group = 'app';\r\n      container.dataset.tab = id;\r\n      const clsNames = cssClass.split(\" \").filter(e => e)\r\n      clsNames.push('tab', 'scrollable')\r\n      \r\n      if (foundry.utils.isEmpty(context[id])) {\r\n        const note = document.createElement('p');\r\n        note.innerHTML = `<em><strong>#${functionName ?? id}</strong> member ${functionName ? 'function' : ''} empty or missing.</em>`;\r\n        note.classList.add('notification');\r\n        container.appendChild(note);\r\n      } else {\r\n        const view = document.createElement('json-viewer');\r\n        view.innerText = context[id];\r\n        view.dataset.action = \"jsonclick\";\r\n        view.dataset.path = path;\r\n        container.appendChild(view);\r\n      }\r\n\r\n      container.classList.add(...clsNames);\r\n      return container;\r\n    });\r\n\r\n    views.unshift(navHTML); \r\n    return views\r\n  }\r\n\r\n  _replaceHTML([navHTML, ...views], content, options) {\r\n    content.replaceChildren(...views);\r\n    content.insertAdjacentHTML('afterbegin', navHTML);\r\n  }\r\n}\r\n","import './common';\r\n\r\nHooks.once('ready', async () => {\r\n  const systemInit = () => ui.notifications.success(`Common and '${game.system.id}' utilities initialized`);\r\n  switch (game.system.id) {\r\n    case 'dnd5e': \r\n      await import('./systems/dnd5e');\r\n      systemInit();\r\n      break;\r\n    default:\r\n      ui.notifications.info('Common utilities initialized');\r\n      break;\r\n  }\r\n});\r\n\r\n"],"names":["CustomDocIndex","augmentIndex","_indexCompendium","_indexWorldCollection","_indexEmbeddedDocuments","game","documentIndex","pack","settings","get","has","metadata","packageName","call","parent","documentName","Hooks","on","packages","getPackageScopes","filter","e","push","choices","Object","fromEntries","map","scope","register","name","hint","config","type","foundry","data","fields","SetField","StringField","default","onChange","_","keys","trees","forEach","tree","uuids","uuid","index","then","ui","notifications","info","this","ExtractorBase","genID","prefix","id","slugify","lowercase","replacement","strict","length","substring","padEnd","validateTarget","target","context","targetParts","split","at","fromUuid","utils","buildUuid","error","Error","parseRange","range","lower","upper","flatMap","p","console","log","Number","isNaN","NaN","promptContext","options","mergeObject","user","getFlag","targets","WORLD","ourPacks","unlockedPacks","openSheets","label","doc","content","toFormGroup","value","outerHTML","join","answer","applications","api","DialogV2","prompt","title","ok","callback","event","button","ux","FormDataExtended","form","object","rejectClose","result","setFlag","packs","locked","collectionField","CONFIG","documentClass","collection","Array","from","instances","values","app","document","collections","getSelection","selection","window","anchorOffset","extentOffset","warn","modify","initialRange","getRangeAt","start","commonAncestorContainer","nodeName","anchorNode","parentElement","setBaseAndExtent","extentNode","PageSplitter","entries","action","cmd","state","dispatch","view","element","dom","closest","pageuuid","dataset","documentUuid","targetuuid","level","DocumentUUIDField","NumberField","position","top","elementToSplitOn","v","i","page","journal","nextUntil","elem","selector","Element","prototype","matches","msMatchesSelector","webkitMatchesSelector","siblings","nextElementSibling","div","createElement","innerHTML","text","headings","querySelectorAll","pageData","heading","pageHTML","sibling","innerText","tagName","createEmbeddedDocuments","KeepIdItem","Item","create","operation","keepId","super","implementation","ItemExtractor","extract","nameFromChildren","childNodes","node","nodeText","hasChildNodes","remove","textContent","trim","replace","fullRange","fragment","cloneContents","wrapper","appendChild","caption","exec","price","denomination","groups","toLowerCase","includes","firstChild","parawrapper","replaceChildren","itemLevel","description","use","levelResult","input","expandObject","_id","folder","item","createDialog","embedText","navigator","clipboard","writeText","TableExtractor","cursor","domAtPos","anchor","nodeType","TEXT_NODE","parse","table","embed","resultLabel","constructor","tableElement","lines","_extract","answers","duplicate","shift","formula","rawPairs","resultLines","some","results","_createEntry","RollTable","targetPack","sheet","render","_discoverTitle","previousElementSibling","classList","contains","querySelector","rows","getElementsByTagName","row","headers","first","rest","cells","debug","flat","ProseMirrorExtractor","proseMirrorMenu","dropdowns","callAll","DataView","ApplicationV2","static","resizable","actions","jsonclick","evt","lastFocusedItem","root","path","inner","getProperty","controls","icon","onClick","force","visible","initial","tabs","functionName","_initializeApplicationOptions","_onFirstRender","apps","_onClose","_prepareContext","system","flags","core","toObject","roll","getRollData","isEmpty","JSON","stringify","_renderHTML","navHTML","renderTemplate","views","cssClass","container","group","tab","clsNames","note","add","unshift","_replaceHTML","insertAdjacentHTML","once","async","import","success"],"mappings":"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"}